!function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(r,a){function s(){!e&&this.init&&this.init.apply(this,arguments)}void 0==a&&(a=r,r="Class");var n=this.prototype;e=!0;var c=new this;e=!1;for(var i in a)c[i]="function"==typeof a[i]&&"function"==typeof n[i]&&t.test(a[i])?function(e,t){return function(){var r=this._super;this._super=n[e];var a=t.apply(this,arguments);return this._super=r,a}}(i,a[i]):a[i];s.prototype=c;var h=new Function("return function "+r+"(){ }")();return s.prototype.constructor=h,s.extend=arguments.callee,s},module.exports=Class}();var Searchbar=Class.extend({searchbar:null,searchable:null,hiddenClass:"searchable-row-hidden",init:function(){if(this.searchbar=document.querySelector(".searchbar"),this.searchable=document.querySelector(".searchable"),this.searchbar&&this.searchable&&this.parseSearchable())for(var e=this.getSearchbarElements(),t=0;t<e.length;++t)this.processSearchbarElement(e[t])},parseSearchable:function(){var e=this.getSearchableRows();if(0===e.length)return!1;for(var t=0;t<e.length;++t)for(var r=e[t].querySelectorAll("[data-searchbar-value]"),a=0;a<r.length;++a)this.processCell(r[a],e[t]);return!0},getSearchableRows:function(){var e=this.searchable.querySelectorAll(".searchable-row");return 0===e.length&&"TABLE"===this.searchable.tagName&&(e=this.searchable.querySelectorAll("tbody tr")),e},processCell:function(e,t){var r="data-"+e.getAttribute("headers"),a=e.getAttribute("data-searchbar-value");t.setAttribute(r,a),1===e.getAttribute("data-searchbar-value-list")&&t.setAttribute(r+"-list",1)},getSearchbarElements:function(){return this.searchbar.querySelectorAll("input, select, button")},processSearchbarElement:function(e){var t="",r=0;switch(e.type){case"text":t="keyup",r=150;break;case"select-one":t="change";break;case"checkbox":case"reset":t="click"}if(t.length>0){var a="reset"!==e.type?this.debounce(this.search,r).bind(this):this.reset.bind(this);e.addEventListener(t,a)}},search:function(){var e=new Event("searchbar:beforeSearch");if(this.searchbar.dispatchEvent(e)){this.resetSearchable();for(var t=this.getSearchableRows(),r=0;r<t.length;++r){for(var a=t[r],s=!0,n=this.getSearchbarElements(),c=0;c<n.length;c++)if(s){var i=n[c],h=this.getValue(i),l=this.getAttr(i);if(l&&h&&"all"!==h){var u="text"!==i.type?this.nonTextSearch(a,l,h):this.textSearch(a,l,h);s=s&&u}}s||a.classList.add(this.hiddenClass)}this.searchbar.dispatchEvent(new Event("searchbar:afterSearch"))}},getValue:function(e){switch(e.type){case"text":return e.value;case"select-one":return e.options[e.selectedIndex].value;case"checkbox":return e.checked}return""},getAttr:function(e){var t=e.getAttribute("id");return t?"data-"+(t=t.replace(/_.*/,"")):""},nonTextSearch:function(e,t,r){return e.hasAttribute(t+"-list")?e.matches("["+t+"*=_"+r+"_]"):e.getAttribute(t)===r},textSearch:function(e,t,r){try{var a=new RegExp(r,"i");return e.getAttribute(t).match(a)}catch(e){}},reset:function(){var e=new Event("searchbar:reset");return!this.searchbar.dispatchEvent(e)||(this.searchbar.reset(),this.resetSearchable()),!1},resetSearchable:function(){for(var e=this.getSearchableRows(),t=0;t<e.length;++t)e[t].classList.remove(this.hiddenClass)},debounce:function(e,t,r){if(0===t)return e;var a;return function(){var s=this,n=arguments,c=function(){a=null,r||e.apply(s,n)},i=r&&!a;clearTimeout(a),a=setTimeout(c,t),i&&e.apply(s,n)}}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsYXNzLmpzIiwic2VhcmNoYmFyLmpzIl0sIm5hbWVzIjpbImluaXRpYWxpemluZyIsImZuVGVzdCIsInRlc3QiLCJ4eXoiLCJ0aGlzIiwiQ2xhc3MiLCJleHRlbmQiLCJjbGFzc05hbWUiLCJwcm9wIiwiaW5pdCIsImFwcGx5IiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwiX3N1cGVyIiwicHJvdG90eXBlIiwibmFtZSIsImZuIiwidG1wIiwicmV0IiwiZnVuYyIsIkZ1bmN0aW9uIiwiY29uc3RydWN0b3IiLCJjYWxsZWUiLCJtb2R1bGUiLCJleHBvcnRzIiwiU2VhcmNoYmFyIiwic2VhcmNoYmFyIiwic2VhcmNoYWJsZSIsImhpZGRlbkNsYXNzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicGFyc2VTZWFyY2hhYmxlIiwiZWxlbWVudHMiLCJnZXRTZWFyY2hiYXJFbGVtZW50cyIsImkiLCJsZW5ndGgiLCJwcm9jZXNzU2VhcmNoYmFyRWxlbWVudCIsInJvd3MiLCJnZXRTZWFyY2hhYmxlUm93cyIsImNlbGxzIiwicXVlcnlTZWxlY3RvckFsbCIsImoiLCJwcm9jZXNzQ2VsbCIsInRhZ05hbWUiLCJjZWxsIiwicm93IiwiYXR0ciIsImdldEF0dHJpYnV0ZSIsInZhbHVlIiwic2V0QXR0cmlidXRlIiwiZWxlbWVudCIsImV2ZW50Iiwid2FpdCIsInR5cGUiLCJkZWJvdW5jZSIsInNlYXJjaCIsImJpbmQiLCJyZXNldCIsImFkZEV2ZW50TGlzdGVuZXIiLCJiZWZvcmVTZWFyY2giLCJFdmVudCIsImRpc3BhdGNoRXZlbnQiLCJyZXNldFNlYXJjaGFibGUiLCJzaG93IiwiZ2V0VmFsdWUiLCJnZXRBdHRyIiwiY3JpdGVyaW9uIiwibm9uVGV4dFNlYXJjaCIsInRleHRTZWFyY2giLCJjbGFzc0xpc3QiLCJhZGQiLCJvcHRpb25zIiwic2VsZWN0ZWRJbmRleCIsImNoZWNrZWQiLCJpZCIsInJlcGxhY2UiLCJoYXNBdHRyaWJ1dGUiLCJtYXRjaGVzIiwicGF0dGVybiIsIlJlZ0V4cCIsIm1hdGNoIiwiZSIsImJlZm9yZVJlc2V0IiwicmVtb3ZlIiwiaW1tZWRpYXRlIiwidGltZW91dCIsImNvbnRleHQiLCJhcmdzIiwibGF0ZXIiLCJjYWxsTm93IiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxHQUFBQSxJQUFBLEVBQUFDLEVBQUEsTUFBQUMsS0FBQSxXQUFBQyxNQUFBLGFBQUEsSUFHQUMsTUFBQUMsTUFBQSxhQUdBQSxNQUFBQyxPQUFBLFNBQUFDLEVBQUFDLEdBdUNBLFFBQUFILE1BRUFMLEdBQUFJLEtBQUFLLE1BQ0FMLEtBQUFLLEtBQUFDLE1BQUFOLEtBQUFPLGVBekNBQyxJQUFBSixJQUNBQSxFQUFBRCxFQUNBQSxFQUFBLFFBR0EsSUFBQU0sR0FBQVQsS0FBQVUsU0FJQWQsSUFBQSxDQUNBLElBQUFjLEdBQUEsR0FBQVYsS0FDQUosSUFBQSxDQUdBLEtBQUEsR0FBQWUsS0FBQVAsR0FFQU0sRUFBQUMsR0FBQSxrQkFBQVAsR0FBQU8sSUFDQSxrQkFBQUYsR0FBQUUsSUFBQWQsRUFBQUMsS0FBQU0sRUFBQU8sSUFDQSxTQUFBQSxFQUFBQyxHQUNBLE1BQUEsWUFDQSxHQUFBQyxHQUFBYixLQUFBUyxNQUlBVCxNQUFBUyxPQUFBQSxFQUFBRSxFQUlBLElBQUFHLEdBQUFGLEVBQUFOLE1BQUFOLEtBQUFPLFVBR0EsT0FGQVAsTUFBQVMsT0FBQUksRUFFQUMsSUFFQUgsRUFBQVAsRUFBQU8sSUFDQVAsRUFBQU8sRUFXQVYsR0FBQVMsVUFBQUEsQ0FHQSxJQUFBSyxHQUFBLEdBQUFDLFVBQ0EsbUJBQUFiLEVBQUEsVUFPQSxPQUxBRixHQUFBUyxVQUFBTyxZQUFBRixFQUdBZCxFQUFBQyxPQUFBSyxVQUFBVyxPQUVBakIsR0FJQWtCLE9BQUFDLFFBQUFuQixRQS9EQSxJQUFBb0IsV0FBQXBCLE1BQUFDLFFBQ0FvQixVQUFBLEtBQ0FDLFdBQUEsS0FDQUMsWUFBQSx3QkFFQW5CLEtBQUEsV0FRQSxHQVBB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e1xuICB2YXIgaW5pdGlhbGl6aW5nID0gZmFsc2UsIGZuVGVzdCA9IC94eXovLnRlc3QoZnVuY3Rpb24oKXt4eXo7fSkgPyAvXFxiX3N1cGVyXFxiLyA6IC8uKi87XG5cbiAgLy8gVGhlIGJhc2UgQ2xhc3MgaW1wbGVtZW50YXRpb24gKGRvZXMgbm90aGluZylcbiAgdGhpcy5DbGFzcyA9IGZ1bmN0aW9uKCl7fTtcblxuICAvLyBDcmVhdGUgYSBuZXcgQ2xhc3MgdGhhdCBpbmhlcml0cyBmcm9tIHRoaXMgY2xhc3NcbiAgQ2xhc3MuZXh0ZW5kID0gZnVuY3Rpb24oY2xhc3NOYW1lLCBwcm9wKSB7XG4gICAgaWYocHJvcCA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcHJvcCA9IGNsYXNzTmFtZTtcbiAgICAgICBjbGFzc05hbWUgPSBcIkNsYXNzXCI7XG4gICAgfVxuXG4gICAgdmFyIF9zdXBlciA9IHRoaXMucHJvdG90eXBlO1xuXG4gICAgLy8gSW5zdGFudGlhdGUgYSBiYXNlIGNsYXNzIChidXQgb25seSBjcmVhdGUgdGhlIGluc3RhbmNlLFxuICAgIC8vIGRvbid0IHJ1biB0aGUgaW5pdCBjb25zdHJ1Y3RvcilcbiAgICBpbml0aWFsaXppbmcgPSB0cnVlO1xuICAgIHZhciBwcm90b3R5cGUgPSBuZXcgdGhpcygpO1xuICAgIGluaXRpYWxpemluZyA9IGZhbHNlO1xuXG4gICAgLy8gQ29weSB0aGUgcHJvcGVydGllcyBvdmVyIG9udG8gdGhlIG5ldyBwcm90b3R5cGVcbiAgICBmb3IgKHZhciBuYW1lIGluIHByb3ApIHtcbiAgICAgIC8vIENoZWNrIGlmIHdlJ3JlIG92ZXJ3cml0aW5nIGFuIGV4aXN0aW5nIGZ1bmN0aW9uXG4gICAgICBwcm90b3R5cGVbbmFtZV0gPSB0eXBlb2YgcHJvcFtuYW1lXSA9PSBcImZ1bmN0aW9uXCIgJiZcbiAgICAgICAgdHlwZW9mIF9zdXBlcltuYW1lXSA9PSBcImZ1bmN0aW9uXCIgJiYgZm5UZXN0LnRlc3QocHJvcFtuYW1lXSkgP1xuICAgICAgICAoZnVuY3Rpb24obmFtZSwgZm4pe1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciB0bXAgPSB0aGlzLl9zdXBlcjtcblxuICAgICAgICAgICAgLy8gQWRkIGEgbmV3IC5fc3VwZXIoKSBtZXRob2QgdGhhdCBpcyB0aGUgc2FtZSBtZXRob2RcbiAgICAgICAgICAgIC8vIGJ1dCBvbiB0aGUgc3VwZXItY2xhc3NcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyID0gX3N1cGVyW25hbWVdO1xuXG4gICAgICAgICAgICAvLyBUaGUgbWV0aG9kIG9ubHkgbmVlZCB0byBiZSBib3VuZCB0ZW1wb3JhcmlseSwgc28gd2VcbiAgICAgICAgICAgIC8vIHJlbW92ZSBpdCB3aGVuIHdlJ3JlIGRvbmUgZXhlY3V0aW5nXG4gICAgICAgICAgICB2YXIgcmV0ID0gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyID0gdG1wO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgIH07XG4gICAgICAgIH0pKG5hbWUsIHByb3BbbmFtZV0pIDpcbiAgICAgICAgcHJvcFtuYW1lXTtcbiAgICB9XG5cbiAgICAvLyBUaGUgZHVtbXkgY2xhc3MgY29uc3RydWN0b3JcbiAgICBmdW5jdGlvbiBDbGFzcygpIHtcbiAgICAgIC8vIEFsbCBjb25zdHJ1Y3Rpb24gaXMgYWN0dWFsbHkgZG9uZSBpbiB0aGUgaW5pdCBtZXRob2RcbiAgICAgIGlmICggIWluaXRpYWxpemluZyAmJiB0aGlzLmluaXQgKVxuICAgICAgICB0aGlzLmluaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICAvLyBQb3B1bGF0ZSBvdXIgY29uc3RydWN0ZWQgcHJvdG90eXBlIG9iamVjdFxuICAgIENsYXNzLnByb3RvdHlwZSA9IHByb3RvdHlwZTtcblxuICAgIC8vIEVuZm9yY2UgdGhlIGNvbnN0cnVjdG9yIHRvIGJlIHdoYXQgd2UgZXhwZWN0XG4gICAgdmFyIGZ1bmMgPSBuZXcgRnVuY3Rpb24oXG4gICAgICAgIFwicmV0dXJuIGZ1bmN0aW9uIFwiICsgY2xhc3NOYW1lICsgXCIoKXsgfVwiXG4gICAgKSgpO1xuICAgIENsYXNzLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGZ1bmM7XG5cbiAgICAvLyBBbmQgbWFrZSB0aGlzIGNsYXNzIGV4dGVuZGFibGVcbiAgICBDbGFzcy5leHRlbmQgPSBhcmd1bWVudHMuY2FsbGVlO1xuXG4gICAgcmV0dXJuIENsYXNzO1xuICB9O1xuXG4gIC8vSSBvbmx5IGFkZGVkIHRoaXMgbGluZVxuICBtb2R1bGUuZXhwb3J0cyA9IENsYXNzO1xufSkoKTtcbiIsIlxyXG4vLyB0aGUgY2xhc3MuZXh0ZW5kIG5wbSBtb2R1bGUgbXVzdCBiZSBpbmNsdWRlZCBwcmlvciB0byB0aGlzXHJcbi8vIGlmIHlvdSB1c2UgdGhlIGluY2x1ZGVkIG1pbmltaXplZCBmaWxlLCB3ZSd2ZSBidW5kbGVkIHRoYXRcclxuLy8gbW9kdWxlIHRvZ2V0aGVyIHdpdGggdGhpcyBvYmplY3QgZm9yIHlvdS5cclxuXHJcbnZhciBTZWFyY2hiYXIgPSBDbGFzcy5leHRlbmQoe1xyXG5cdHNlYXJjaGJhcjogbnVsbCxcclxuXHRzZWFyY2hhYmxlOiBudWxsLFxyXG5cdGhpZGRlbkNsYXNzOiBcInNlYXJjaGFibGUtcm93LWhpZGRlblwiLFxyXG5cclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuc2VhcmNoYmFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zZWFyY2hiYXJcIik7XHJcblx0XHR0aGlzLnNlYXJjaGFibGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNlYXJjaGFibGVcIik7XHJcblxyXG5cdFx0Ly8gdG8gaGF2ZSBhIHNlYXJjaGJhciwgd2UgbmVlZCBib3RoIHRoZSBzZWFyY2hiYXIgZWxlbWVudCBhbmRcclxuXHRcdC8vIHRoZSBzZWFyY2hhYmxlIGRhdGEgc2V0LiAgd2l0aG91dCB0aG9zZSwgd2UgY2FuIHNpbXBseSBxdWl0XHJcblx0XHQvLyBiZWNhdXNlLCBjbGVhcmx5LCB0aGlzIHBhZ2UgZG9lc24ndCBuZWVkIHRoaXMgZnVuY3Rpb25hbGl0eS5cclxuXHJcblx0XHRpZiAoIXRoaXMuc2VhcmNoYmFyIHx8ICF0aGlzLnNlYXJjaGFibGUpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIG5vdyB0aGF0IHdlIGtub3cgd2UgaGF2ZSB0aG9zZSwgd2UgY2FuIHBhcnNlIHRoZSBzZWFyY2hhYmxlXHJcblx0XHQvLyBkYXRhIHNldCB0byBwcmVwYXJlIGl0IGZvciB1c2UuICBpdCdzIHBvc3NpYmxlIHRoYXQgdGhpcyBtZXRob2RcclxuXHRcdC8vIHJldHVybnMgZmFsc2Ugd2hlbiB0aGVyZSBhcmUgbm93IHJvd3Mgd2l0aGluIHRoZSBzZXQgdG8gd29ya1xyXG5cdFx0Ly8gd2l0aC5cclxuXHJcblx0XHRpZiAoIXRoaXMucGFyc2VTZWFyY2hhYmxlKCkpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGZpbmFsbHksIG91ciBzZWFyY2hhYmxlIGRhdGEgc2V0IGlzIHJlYWR5IHRvIGdvLiAgbm93LCB3ZSBjYW5cclxuXHRcdC8vIGhvb2sgdXAgZXZlbnRzIHRvIG91ciBzZWFyY2hiYXIuXHJcblxyXG5cdFx0dmFyIGVsZW1lbnRzID0gdGhpcy5nZXRTZWFyY2hiYXJFbGVtZW50cygpO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHR0aGlzLnByb2Nlc3NTZWFyY2hiYXJFbGVtZW50KGVsZW1lbnRzW2ldKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRwYXJzZVNlYXJjaGFibGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHJvd3MgPSB0aGlzLmdldFNlYXJjaGFibGVSb3dzKCk7XHJcblxyXG5cdFx0Ly8gaWYgd2UgZG9uJ3QgaGF2ZSByb3dzLCB0aGVuIHdlIGNhbiBxdWl0LlxyXG5cclxuXHRcdGlmIChyb3dzLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gb3RoZXJ3aXNlLCBmb3IgdGhlIGNoaWxkcmVuIG9mIG91ciByb3dzIC0tIHdoaWNoIGFyZSBsaWtlbHlcclxuXHRcdC8vIHRhYmxlIGNlbGxzLCBidXQgY291bGQgYmUgc29tZXRoaW5nIGVsc2UgLS0gd2Ugd2FudCB0byBwcm9jZXNzXHJcblx0XHQvLyB0aGVtIGluZGl2aWR1YWxseSB3aXRoIHRoZSBtZXRob2QgYmVsb3cuXHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCByb3dzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdHZhciBjZWxscyA9IHJvd3NbaV0ucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLXNlYXJjaGJhci12YWx1ZV1cIik7XHJcblx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgY2VsbHMubGVuZ3RoOyArK2opIHtcclxuXHRcdFx0XHR0aGlzLnByb2Nlc3NDZWxsKGNlbGxzW2pdLCByb3dzW2ldKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH0sXHJcblxyXG5cdGdldFNlYXJjaGFibGVSb3dzOiBmdW5jdGlvbigpIHtcclxuXHJcblx0XHQvLyBmb3IgbWF4aW11bSBmbGV4aWJpbGl0eSwgd2Ugd2FudCB0byBtYWtlIHN1cmUgdGhhdCBhIGRldmVsb3BlclxyXG5cdFx0Ly8gdXNpbmcgb3VyIHNlYXJjaGJhciBjYW4gc3BlY2lmeSB3aGF0IHNob3VsZCBiZSBjb25zaWRlcmVkIGFcclxuXHRcdC8vIHNlYXJjaGFibGUgcm93LiAgYnV0LCBpZiB0aGV5IGRvbid0IGFuZCBpZiB0aGUgc2VhcmNoYWJsZSBET01cclxuXHRcdC8vIGVsZW1lbnQgaXMgYSB0YWJsZSwgdGhlbiB3ZSdsbCBqdXN0IHVzZSB0aGUgcm93cyBpbiBpdHMgdGFibGVcclxuXHRcdC8vIGJvZHkgYnkgZGVmYXVsdC5cclxuXHJcblx0XHR2YXIgcm93cyA9IHRoaXMuc2VhcmNoYWJsZS5xdWVyeVNlbGVjdG9yQWxsKFwiLnNlYXJjaGFibGUtcm93XCIpO1xyXG5cdFx0aWYgKHJvd3MubGVuZ3RoID09PSAwICYmIHRoaXMuc2VhcmNoYWJsZS50YWdOYW1lID09PSBcIlRBQkxFXCIpIHtcclxuXHRcdFx0cm93cyA9IHRoaXMuc2VhcmNoYWJsZS5xdWVyeVNlbGVjdG9yQWxsKFwidGJvZHkgdHJcIik7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHJvd3M7XHJcblx0fSxcclxuXHJcblx0cHJvY2Vzc0NlbGw6IGZ1bmN0aW9uKGNlbGwsIHJvdykge1xyXG5cclxuXHRcdC8vIHRvIHByb2Nlc3MgYSBjZWxsLCB3ZSB3YW50IHRvIGFkZCBIVE1MNSBkYXRhIGF0dHJpYnV0ZXMgdGhhdFxyXG5cdFx0Ly8gY29ycmVzcG9uZCB0byBpbmZvcm1hdGlvbiBleHRyYWN0ZWQgZnJvbSB0aGUgY2VsbCBpdHNlbGYgdG9cclxuXHRcdC8vIHRoZSBzcGVjaWZpZWQgcm93LiAgdGhpcyBpcyBiZWNhdXNlIG91ciBzZWFyY2ggbWV0aG9kIGxvb2tzXHJcblx0XHQvLyBhdCB0aGUgcm93cyB3aGVuIG1hdGNoaW5nIGVudHJpZXMgYWdhaW5zdCBkYXRhLlxyXG5cclxuXHRcdHZhciBhdHRyID0gXCJkYXRhLVwiICsgY2VsbC5nZXRBdHRyaWJ1dGUoXCJoZWFkZXJzXCIpO1xyXG5cdFx0dmFyIHZhbHVlID0gY2VsbC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXNlYXJjaGJhci12YWx1ZVwiKTtcclxuXHRcdHJvdy5zZXRBdHRyaWJ1dGUoYXR0ciwgdmFsdWUpO1xyXG5cclxuXHRcdGlmIChjZWxsLmdldEF0dHJpYnV0ZShcImRhdGEtc2VhcmNoYmFyLXZhbHVlLWxpc3RcIikgPT09IDEpIHtcclxuXHRcdFx0cm93LnNldEF0dHJpYnV0ZShhdHRyICsgXCItbGlzdFwiLCAxKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRnZXRTZWFyY2hiYXJFbGVtZW50czogZnVuY3Rpb24oKSB7XHJcblxyXG5cdFx0Ly8gb3VyIHNlYXJjaGJhciB1c2VzIHRoZXNlIEhUTUwgZWxlbWVudHMgYXQgdGhlIG1vbWVudC4gIGlmIHdlXHJcblx0XHQvLyBhZCBtb3JlLCB3ZSdsbCBuZWVkIHRvIHVwZGF0ZSB0aGlzIGxpc3QuXHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuc2VhcmNoYmFyLnF1ZXJ5U2VsZWN0b3JBbGwoXCJpbnB1dCwgc2VsZWN0LCBidXR0b25cIik7XHJcblx0fSxcclxuXHJcblx0cHJvY2Vzc1NlYXJjaGJhckVsZW1lbnQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcclxuXHRcdHZhciBldmVudCA9IFwiXCIsIHdhaXQgPSAwO1xyXG5cclxuXHRcdC8vIHRoZSBldmVudCB3ZSB3YW50IHRvIHVzZSBpcyBiYXNlZCBvbiB0aGUgdHlwZSBvZiBlbGVtZW50IHRoYXRcclxuXHRcdC8vIHdlJ3JlIHdvcmtpbmcgd2l0aC4gIG1vc3Qgb2Ygb3VyIGV2ZW50cyBkb24ndCBuZWVkIHRvIGJlXHJcblx0XHQvLyBkZWJvdW5jZWQsIGJ1dCBpZiB3ZSBydW4gaW50byBvbmUgdGhhdCBkb2VzLCB3ZSBjYW4gc2V0IG91clxyXG5cdFx0Ly8gd2FpdCB2YXJpYWJsZSB0byBzb21ldGhpbmcgb3RoZXIgdGhhbiB6ZXJvLlxyXG5cclxuXHRcdHN3aXRjaCAoZWxlbWVudC50eXBlKSB7XHJcblx0XHRcdGNhc2UgXCJ0ZXh0XCI6XHJcblx0XHRcdFx0ZXZlbnQgPSBcImtleXVwXCI7XHJcblx0XHRcdFx0d2FpdCA9IDE1MDtcclxuXHRcdFx0XHRicmVhaztcclxuXHJcblx0XHRcdGNhc2UgXCJzZWxlY3Qtb25lXCI6XHJcblx0XHRcdFx0ZXZlbnQgPSBcImNoYW5nZVwiO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdFx0Y2FzZSBcImNoZWNrYm94XCI6XHJcblx0XHRcdFx0ZXZlbnQgPSBcImNsaWNrXCI7XHJcblx0XHRcdFx0YnJlYWs7XHJcblxyXG5cdFx0XHRjYXNlIFwicmVzZXRcIjpcclxuXHRcdFx0XHRldmVudCA9IFwiY2xpY2tcIjtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoZXZlbnQubGVuZ3RoID4gMCkge1xyXG5cclxuXHRcdFx0Ly8gaWYgd2UgaWRlbnRpZmllZCBhbiBldmVudCB0byBsaXN0ZW4gZm9yLCB3ZSdsbCBub3cgaWRlbnRpZnlcclxuXHRcdFx0Ly8gd2hpY2ggZnVuY3Rpb24gdG8gY2FsbC4gIGlmIHdlJ3JlIG5vdCBtZXNzaW5nIHdpdGggdGhlIHJlc2V0XHJcblx0XHRcdC8vIGVsZW1lbnQsIHdlIHNlYXJjaDsgb3RoZXJ3aXNlIHdlIHJlc2V0LlxyXG5cclxuXHRcdFx0dmFyIGZ1bmMgPSBlbGVtZW50LnR5cGUgIT09IFwicmVzZXRcIlxyXG5cdFx0XHRcdD8gdGhpcy5kZWJvdW5jZSh0aGlzLnNlYXJjaCwgd2FpdCkuYmluZCh0aGlzKVxyXG5cdFx0XHRcdDogdGhpcy5yZXNldC5iaW5kKHRoaXMpO1xyXG5cclxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBmdW5jKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRzZWFyY2g6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIGJlZm9yZVNlYXJjaCA9IG5ldyBFdmVudChcInNlYXJjaGJhcjpiZWZvcmVTZWFyY2hcIik7XHJcblx0XHR2YXIgY2FuY2VsbGVkID0gIXRoaXMuc2VhcmNoYmFyLmRpc3BhdGNoRXZlbnQoYmVmb3JlU2VhcmNoKTtcclxuXHRcdGlmIChjYW5jZWxsZWQpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGFzc3VtaW5nIHNvbWV0aGluZyBlbHNlIGRpZG4ndCBjYW5jZWwgb3VyIHNlYXJjaCwgdGhlIGZpcnN0XHJcblx0XHQvLyB0aGluZyB3ZSBkbyBpcyByZXNldCBvdXIgdGFibGUuICB0aGF0IHdheSwgd2Uga25vdyB0aGF0IHdlXHJcblx0XHQvLyBzdGFydCB3aXRoIHRoZSBlbnRpcmUgdGhpbmcgdmlzaWJsZSBhbmQgd2UnbGwgZmluZCB0aGUgb25lc1xyXG5cdFx0Ly8gdGhhdCBuZWVkIHRvIGJlIGhpZGRlbiBiZWxvdy5cclxuXHJcblx0XHR0aGlzLnJlc2V0U2VhcmNoYWJsZSgpO1xyXG5cdFx0dmFyIHJvd3MgPSB0aGlzLmdldFNlYXJjaGFibGVSb3dzKCk7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0dmFyIHJvdyA9IHJvd3NbaV0sIHNob3cgPSB0cnVlO1xyXG5cclxuXHRcdFx0Ly8gZm9yIGVhY2ggcm93LCB3ZSBuZWVkIHRvIGNvbXBhcmUgdGhlIGluZm9ybWF0aW9uIGluIHRoZVxyXG5cdFx0XHQvLyBIVE1MNSBkYXRhIGF0dHJpYnV0ZXMgYWRkZWQgYnkgdGhlIHBhcnNlU2VhcmNoYWJsZSgpIG1ldGhvZFxyXG5cdFx0XHQvLyBhYm92ZSBhZ2FpbnN0IHRoZSB2YWx1ZXMgaW4gb3VyIHNlYXJjaGJhciBlbGVtZW50cy5cclxuXHJcblx0XHRcdHZhciBlbGVtZW50cyA9IHRoaXMuZ2V0U2VhcmNoYmFyRWxlbWVudHMoKTtcclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBlbGVtZW50cy5sZW5ndGg7IGorKykge1xyXG5cdFx0XHRcdGlmICghc2hvdykge1xyXG5cclxuXHRcdFx0XHRcdC8vIHdlIHVzZSBBTkQgbG9naWMgaGVyZS4gIHRoZSBmaXJzdCB0aGluZyB0aGF0IHdvdWxkXHJcblx0XHRcdFx0XHQvLyBoaWRlIG91ciByb3cgbWVhbnMgdGhlIHJvdyBpcyBoaWRkZW4gYW5kIHdlIGNhblxyXG5cdFx0XHRcdFx0Ly8gc2tpcCBhbGwgb3RoZXIgY3JpdGVyaW9uLlxyXG5cclxuXHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dmFyIGVsZW1lbnQgPSBlbGVtZW50c1tqXTtcclxuXHRcdFx0XHR2YXIgdmFsdWUgPSB0aGlzLmdldFZhbHVlKGVsZW1lbnQpO1xyXG5cdFx0XHRcdHZhciBhdHRyID0gdGhpcy5nZXRBdHRyKGVsZW1lbnQpO1xyXG5cclxuXHRcdFx0XHQvLyBpZiB3ZSBkb24ndCBoYXZlIGFuIGF0dHJpYnV0ZSBvciB2YWx1ZSBvciBpZiB0aGUgdmFsdWVcclxuXHRcdFx0XHQvLyB3ZSBkbyBoYXZlIGluZGljYXRlcyB0aGF0IHdlIHNob3VsZCBiZSBzaG93aW5nIGFsbCBvZlxyXG5cdFx0XHRcdC8vIG91ciByb3dzLCB3ZSBjYW4gc2ltcGx5IG1vdmUgb247IHRoaXMgY3JpdGVyaWEgaXMsXHJcblx0XHRcdFx0Ly8gZWZmZWN0aXZlbHksIGFsd2F5cyBtZXQuXHJcblxyXG5cdFx0XHRcdGlmICghYXR0ciB8fCAhdmFsdWUgfHwgdmFsdWUgPT09IFwiYWxsXCIpIHtcclxuXHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dmFyIGNyaXRlcmlvbiA9IGVsZW1lbnQudHlwZSAhPT0gXCJ0ZXh0XCJcclxuXHRcdFx0XHRcdD8gdGhpcy5ub25UZXh0U2VhcmNoKHJvdywgYXR0ciwgdmFsdWUpXHJcblx0XHRcdFx0XHQ6IHRoaXMudGV4dFNlYXJjaChyb3csIGF0dHIsIHZhbHVlKTtcclxuXHJcblx0XHRcdFx0c2hvdyA9IHNob3cgJiYgY3JpdGVyaW9uO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIXNob3cpIHtcclxuXHJcblx0XHRcdFx0Ly8gZmluYWxseSwgaWYgdGhpcyByb3cgc2hvdWxkIG5vdCBiZSBzaG93biwgdGhlbiB3ZSBhZGRcclxuXHRcdFx0XHQvLyB0aGUgaGlkZGVuIGNsYXNzIHRvIGl0LlxyXG5cclxuXHRcdFx0XHRyb3cuY2xhc3NMaXN0LmFkZCh0aGlzLmhpZGRlbkNsYXNzKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuc2VhcmNoYmFyLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KFwic2VhcmNoYmFyOmFmdGVyU2VhcmNoXCIpKTtcclxuXHR9LFxyXG5cclxuXHRnZXRWYWx1ZTogZnVuY3Rpb24oZWxlbWVudCkge1xyXG5cclxuXHRcdC8vIHRleHQsIHNlbGVjdHMsIGFuZCBjaGVja2JveGVzIGFsbCB3b3JrIGRpZmZlcmVudGx5IHdpdGhcclxuXHRcdC8vIHJlc3BlY3QgdG8gd2hhdCB3ZSBjb25zaWRlciBvdXIgXCJ2YWx1ZVwiIGZvciBzZWFyY2hpbmdcclxuXHRcdC8vIHB1cnBvc2VzLiAgdGhpcyBzd2l0Y2ggc3RhdGVtZW50IG1peGVzIHRoaW5ncyB1cCBhbmRcclxuXHRcdC8vIGdyYWJzIG9ubHkgd2hhdCB3ZSBuZWVkIGR1cmluZyBvdXIgc2VhcmNoIGFib3ZlIHRvIG1ha2VcclxuXHRcdC8vIHRoaW5ncyBoYXBwZW4uXHJcblxyXG5cdFx0c3dpdGNoIChlbGVtZW50LnR5cGUpIHtcclxuXHRcdFx0Y2FzZSBcInRleHRcIjpcclxuXHRcdFx0XHRyZXR1cm4gZWxlbWVudC52YWx1ZTtcclxuXHJcblx0XHRcdGNhc2UgXCJzZWxlY3Qtb25lXCI6XHJcblx0XHRcdFx0cmV0dXJuIGVsZW1lbnQub3B0aW9uc1tlbGVtZW50LnNlbGVjdGVkSW5kZXhdLnZhbHVlO1xyXG5cclxuXHRcdFx0Y2FzZSBcImNoZWNrYm94XCI6XHJcblx0XHRcdFx0cmV0dXJuIGVsZW1lbnQuY2hlY2tlZDtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gXCJcIjtcclxuXHR9LFxyXG5cclxuXHRnZXRBdHRyOiBmdW5jdGlvbihlbGVtZW50KSB7XHJcblxyXG5cdFx0Ly8gdGhlIEhUTUw1IGRhdGEgZWxlbWVudHMgdGhhdCBwYXJzZVNlYXJjaGFibGUoKSBjcmVhdGVzXHJcblx0XHQvLyBhcmUgZGF0YS1baWRdIHdoZXJlIHRoZSBpZCBpcyB0aGUgdmFsdWUgb2Ygb3VyIGVsZW1lbnQnc1xyXG5cdFx0Ly8gSUQgYXR0cmlidXRlLlxyXG5cclxuXHRcdHZhciBpZCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiaWRcIik7XHJcblxyXG5cdFx0aWYgKGlkKSB7XHJcblxyXG5cdFx0XHQvLyBpZiB3ZSBoYXZlIGFuIElELCB0aGVuIHdlIG5lZWQgdG8gcmVtb3ZlIGV2ZXJ5dGhpbmdcclxuXHRcdFx0Ly8gYWZ0ZXIgdGhlIHVuZGVyc2NvcmUsIGluY2x1ZGluZyB0aGUgdW5kZXJzY29yZS4gIHdlXHJcblx0XHRcdC8vIGV4cGVjdCBvdXIgSURzIGZvciBzZWFyY2hpbmcgZWxlbWVudHMgdG8gYmUgaW4gdGhlXHJcblx0XHRcdC8vIGZvcm0gb2YgW2lkXV9bdHlwZV0sIHNvIHRoaXMgc2ltcGx5IGxlYXZlcyB1cyB3aXRoXHJcblx0XHRcdC8vIHRoZSBpZC5cclxuXHJcblx0XHRcdGlkID0gaWQucmVwbGFjZSgvXy4qLywgXCJcIik7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRyZXR1cm4gXCJcIjtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBzdGlsbCBoZXJlPyAgdGhlbiB3ZSBjYW4gY29uc3RydWN0IHRoZSBvdXIgZGF0YVxyXG5cdFx0Ly8gYXR0cmlidXRlIHVzaW5nIHRoZSBJRCB3ZSdyZSBsZWZ0IHdpdGguXHJcblxyXG5cdFx0cmV0dXJuIFwiZGF0YS1cIiArIGlkO1xyXG5cdH0sXHJcblxyXG5cdG5vblRleHRTZWFyY2g6IGZ1bmN0aW9uKHJvdywgYXR0ciwgdmFsdWUpIHtcclxuXHJcblx0XHQvLyBpZiBvdXIgcm93IGhhcyBhIGxpc3QgZmxhZyBmb3IgdGhpcyBhdHRyaWJ1dGUsIHRoZW4gd2VcclxuXHRcdC8vIHdhbnQgdG8gc2VlIGlmIG91ciBhdHRyaWJ1dGUgY29udGFpbnMgdGhlIHZhbHVlLiAgb3RoZXJ3aXNlLFxyXG5cdFx0Ly8gd2UgY2hlY2sgdG8gc2VlIHRoZSBhdHRyaWJ1dGUgbWF0Y2hlcyBpdC4gIHdpdGggcmVzcGVjdCB0b1xyXG5cdFx0Ly8gdGhlIG1hdGNoZXMoKSBjYWxsIGhlcmUsIGlmIHdlIGFzc3VtZSBvdXIgdmFsdWUgaXMgMSwgdGhlblxyXG5cdFx0Ly8gd2Ugc2VhcmNoIGZvciBfMV8uICB0aGlzIGlzIHRvIGF2b2lkIGludmFsaWQgc2VsZWN0b3IgZXJyb3JzXHJcblx0XHQvLyB3aXRoaW4gdGhlIGphdmFzY3JpcHQuICBmdXJ0aGVyLCBpdCBoZWxwcyBkaXN0aW5ndWlzaCBiZXR3ZWVuXHJcblx0XHQvLyBfMV8gYW5kIF8xMV8gb3IgX3dvbl8gYW5kIF93b25kZXJfLCBmb3IgZXhhbXBsZS5cclxuXHJcblx0XHRyZXR1cm4gcm93Lmhhc0F0dHJpYnV0ZShhdHRyICsgXCItbGlzdFwiKVxyXG5cdFx0XHQ/IHJvdy5tYXRjaGVzKFwiW1wiICsgYXR0ciArIFwiKj1fXCIgKyB2YWx1ZSArIFwiX11cIilcclxuXHRcdFx0OiByb3cuZ2V0QXR0cmlidXRlKGF0dHIpID09PSB2YWx1ZTtcclxuXHR9LFxyXG5cclxuXHR0ZXh0U2VhcmNoOiBmdW5jdGlvbihyb3csIGF0dHIsIHZhbHVlKSB7XHJcblxyXG5cdFx0Ly8gZm9yIHRleHQgc2VhcmNoZXMsIHdlIGNvbnN0cnVjdCBhIHJlZ2V4IGZyb20gdGhlIHZhbHVlIG9mXHJcblx0XHQvLyBvdXIgc2VhcmNoIGZpZWxkIGFuZCBzZWUgaWYgdGhpcyByb3cgbWF0Y2hlcyBpdC4gIHdlIHB1dFxyXG5cdFx0Ly8gdGhpcyBhbGwgaW5zaWRlIGEgdHJ5L2NhdGNoIGJsb2NrIGJlY2F1c2UgaXQncyBwb3NzaWJsZSB0b1xyXG5cdFx0Ly8gY3JlYXRlIGEgdmFsdWUgdGhhdCBjYW4ndCBiZSBhIHJlZ2V4LCBhbmQgdGhlbiBhbiBleGNlcHRpb25cclxuXHRcdC8vIGlzIHRocm93bi5cclxuXHJcblx0XHR0cnkge1xyXG5cdFx0XHR2YXIgcGF0dGVybiA9IG5ldyBSZWdFeHAodmFsdWUsIFwiaVwiKTtcclxuXHRcdFx0cmV0dXJuIHJvdy5nZXRBdHRyaWJ1dGUoYXR0cikubWF0Y2gocGF0dGVybik7XHJcblx0XHR9IGNhdGNoIChlKSB7XHJcblxyXG5cdFx0XHQvLyBpZiB3ZSBjYXRjaCBvdXIgZXhjZXB0aW9uLCB3ZSBkbyBub3RoaW5nLiAgd2VcclxuXHRcdFx0Ly8gY291bGQgYWRkIGEgcmV0dXJuIHN0YXRlbWVudCBoZXJlLCBidXQgaXQncyB0aGVcclxuXHRcdFx0Ly8gZW5kIG9mIHRoZSBmdW5jdGlvbiBhbHJlYWR5LlxyXG5cclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRyZXNldDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgYmVmb3JlUmVzZXQgPSBuZXcgRXZlbnQoXCJzZWFyY2hiYXI6cmVzZXRcIik7XHJcblx0XHR2YXIgY2FuY2VsbGVkID0gIXRoaXMuc2VhcmNoYmFyLmRpc3BhdGNoRXZlbnQoYmVmb3JlUmVzZXQpO1xyXG5cclxuXHRcdGlmICghY2FuY2VsbGVkKSB7XHJcblxyXG5cdFx0XHQvLyBpZiBubyBvbmUgY2FuY2VsbGVkIG91ciByZXNldCwgdGhlbiB3ZSBqdXN0IHJlc2V0IHRoZVxyXG5cdFx0XHQvLyBzZWFyY2hiYXIgZm9ybSBhbmQgb3VyIHNlYXJjaGFibGUgZGF0YSBzZXQuXHJcblxyXG5cdFx0XHR0aGlzLnNlYXJjaGJhci5yZXNldCgpO1xyXG5cdFx0XHR0aGlzLnJlc2V0U2VhcmNoYWJsZSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9LFxyXG5cclxuXHRyZXNldFNlYXJjaGFibGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHJvd3MgPSB0aGlzLmdldFNlYXJjaGFibGVSb3dzKCk7XHJcblxyXG5cdFx0Ly8gcmVzZXR0aW5nIG91ciBkYXRhIHNldCBpcyBzaW1wbGU6ICB3ZSBqdXN0IHJlbW92ZSB0aGUgaGlkZGVuXHJcblx0XHQvLyBjbGFzcyBmcm9tIGFsbCByb3dzLlxyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcm93cy5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRyb3dzW2ldLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5oaWRkZW5DbGFzcyk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0ZGVib3VuY2U6IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkge1xyXG5cdFx0aWYgKHdhaXQgPT09IDApIHtcclxuXHRcdFx0cmV0dXJuIGZ1bmM7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gc291cmNlOiBodHRwczovL2Rhdmlkd2Fsc2gubmFtZS9qYXZhc2NyaXB0LWRlYm91bmNlLWZ1bmN0aW9uXHJcblxyXG5cdFx0dmFyIHRpbWVvdXQ7XHJcblx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7XHJcblx0XHRcdHZhciBjb250ZXh0ID0gdGhpcywgYXJncyA9IGFyZ3VtZW50cztcclxuXHRcdFx0dmFyIGxhdGVyID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0dGltZW91dCA9IG51bGw7XHJcblx0XHRcdFx0aWYgKCFpbW1lZGlhdGUpIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XHJcblx0XHRcdH07XHJcblx0XHRcdHZhciBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0O1xyXG5cdFx0XHRjbGVhclRpbWVvdXQodGltZW91dCk7XHJcblx0XHRcdHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTtcclxuXHRcdFx0aWYgKGNhbGxOb3cpIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XHJcblx0XHR9O1xyXG5cdH1cclxufSk7XHJcbiJdfQ==
