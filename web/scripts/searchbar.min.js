!function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(r,a){function s(){!e&&this.init&&this.init.apply(this,arguments)}void 0==a&&(a=r,r="Class");var n=this.prototype;e=!0;var c=new this;e=!1;for(var i in a)c[i]="function"==typeof a[i]&&"function"==typeof n[i]&&t.test(a[i])?function(e,t){return function(){var r=this._super;this._super=n[e];var a=t.apply(this,arguments);return this._super=r,a}}(i,a[i]):a[i];s.prototype=c;var h=new Function("return function "+r+"(){ }")();return s.prototype.constructor=h,s.extend=arguments.callee,s},module.exports=Class}();var Searchbar=Class.extend({searchbar:null,searchable:null,hiddenClass:"searchable-row-hidden",init:function(){if(this.searchbar=document.querySelector(".searchbar"),this.searchable=document.querySelector(".searchable"),this.searchbar&&this.searchable&&this.parseSearchable())for(var e=this.getSearchbarElements(),t=0;t<e.length;++t)this.processSearchbarElement(e[t])},parseSearchable:function(){var e=this.getSearchableRows();if(0===e.length)return!1;for(var t=0;t<e.length;++t)for(var r=e[t].querySelectorAll("[data-searchbar-value]"),a=0;a<r.length;++a)this.processCell(r[a],e[t]);return!0},getSearchableRows:function(){var e=this.searchable.querySelectorAll(".searchable-row");return 0===e.length&&"TABLE"===this.searchable.tagName&&(e=this.searchable.querySelectorAll("tbody tr")),e},processCell:function(e,t){var r="data-"+e.getAttribute("headers"),a=e.getAttribute("data-searchbar-value");t.setAttribute(r,a),"1"===e.getAttribute("data-searchbar-value-list")&&t.setAttribute(r+"-list",1)},getSearchbarElements:function(){return this.searchbar.querySelectorAll("input, select, button")},processSearchbarElement:function(e){var t="",r=0;switch(e.type){case"text":t="keyup",r=150;break;case"select-one":t="change";break;case"checkbox":case"reset":t="click"}if(t.length>0){var a="reset"!==e.type?this.debounce(this.search,r).bind(this):this.reset.bind(this);e.addEventListener(t,a)}},search:function(){var e=new Event("searchbar:beforeSearch");if(this.searchbar.dispatchEvent(e)){this.resetSearchable();for(var t=this.getSearchableRows(),r=0;r<t.length;++r){for(var a=t[r],s=!0,n=this.getSearchbarElements(),c=0;c<n.length;c++)if(s){var i=n[c],h=this.getValue(i),l=this.getAttr(i);if(l&&h&&"all"!==h){var u="text"!==i.type?this.nonTextSearch(a,l,h):this.textSearch(a,l,h);s=s&&u}}s||a.classList.add(this.hiddenClass)}this.searchbar.dispatchEvent(new Event("searchbar:afterSearch"))}},getValue:function(e){switch(e.type){case"text":return e.value;case"select-one":return e.options[e.selectedIndex].value;case"checkbox":return e.checked}return""},getAttr:function(e){var t=e.getAttribute("id");return t?"data-"+(t=t.replace(/_.*/,"")):""},nonTextSearch:function(e,t,r){return e.hasAttribute(t+"-list")?e.matches("["+t+"*=_"+r+"_]"):e.getAttribute(t)===r},textSearch:function(e,t,r){try{var a=new RegExp(r,"i");return e.getAttribute(t).match(a)}catch(e){return!1}},reset:function(){var e=new Event("searchbar:reset");return!this.searchbar.dispatchEvent(e)||(this.searchbar.reset(),this.resetSearchable()),!1},resetSearchable:function(){for(var e=this.getSearchableRows(),t=0;t<e.length;++t)e[t].classList.remove(this.hiddenClass)},debounce:function(e,t,r){if(0===t)return e;var a;return function(){var s=this,n=arguments,c=function(){a=null,r||e.apply(s,n)},i=r&&!a;clearTimeout(a),a=setTimeout(c,t),i&&e.apply(s,n)}}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsYXNzLmpzIiwic2VhcmNoYmFyLmpzIl0sIm5hbWVzIjpbImluaXRpYWxpemluZyIsImZuVGVzdCIsInRlc3QiLCJ4eXoiLCJ0aGlzIiwiQ2xhc3MiLCJleHRlbmQiLCJjbGFzc05hbWUiLCJwcm9wIiwiaW5pdCIsImFwcGx5IiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwiX3N1cGVyIiwicHJvdG90eXBlIiwibmFtZSIsImZuIiwidG1wIiwicmV0IiwiZnVuYyIsIkZ1bmN0aW9uIiwiY29uc3RydWN0b3IiLCJjYWxsZWUiLCJtb2R1bGUiLCJleHBvcnRzIiwiU2VhcmNoYmFyIiwic2VhcmNoYmFyIiwic2VhcmNoYWJsZSIsImhpZGRlbkNsYXNzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicGFyc2VTZWFyY2hhYmxlIiwiZWxlbWVudHMiLCJnZXRTZWFyY2hiYXJFbGVtZW50cyIsImkiLCJsZW5ndGgiLCJwcm9jZXNzU2VhcmNoYmFyRWxlbWVudCIsInJvd3MiLCJnZXRTZWFyY2hhYmxlUm93cyIsImNlbGxzIiwicXVlcnlTZWxlY3RvckFsbCIsImoiLCJwcm9jZXNzQ2VsbCIsInRhZ05hbWUiLCJjZWxsIiwicm93IiwiYXR0ciIsImdldEF0dHJpYnV0ZSIsInZhbHVlIiwic2V0QXR0cmlidXRlIiwiZWxlbWVudCIsImV2ZW50Iiwid2FpdCIsInR5cGUiLCJkZWJvdW5jZSIsInNlYXJjaCIsImJpbmQiLCJyZXNldCIsImFkZEV2ZW50TGlzdGVuZXIiLCJiZWZvcmVTZWFyY2giLCJFdmVudCIsImRpc3BhdGNoRXZlbnQiLCJyZXNldFNlYXJjaGFibGUiLCJzaG93IiwiZ2V0VmFsdWUiLCJnZXRBdHRyIiwiY3JpdGVyaW9uIiwibm9uVGV4dFNlYXJjaCIsInRleHRTZWFyY2giLCJjbGFzc0xpc3QiLCJhZGQiLCJvcHRpb25zIiwic2VsZWN0ZWRJbmRleCIsImNoZWNrZWQiLCJpZCIsInJlcGxhY2UiLCJoYXNBdHRyaWJ1dGUiLCJtYXRjaGVzIiwicGF0dGVybiIsIlJlZ0V4cCIsIm1hdGNoIiwiZSIsImJlZm9yZVJlc2V0IiwicmVtb3ZlIiwiaW1tZWRpYXRlIiwidGltZW91dCIsImNvbnRleHQiLCJhcmdzIiwibGF0ZXIiLCJjYWxsTm93IiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxHQUFBQSxJQUFBLEVBQUFDLEVBQUEsTUFBQUMsS0FBQSxXQUFBQyxNQUFBLGFBQUEsSUFHQUMsTUFBQUMsTUFBQSxhQUdBQSxNQUFBQyxPQUFBLFNBQUFDLEVBQUFDLEdBdUNBLFFBQUFILE1BRUFMLEdBQUFJLEtBQUFLLE1BQ0FMLEtBQUFLLEtBQUFDLE1BQUFOLEtBQUFPLGVBekNBQyxJQUFBSixJQUNBQSxFQUFBRCxFQUNBQSxFQUFBLFFBR0EsSUFBQU0sR0FBQVQsS0FBQVUsU0FJQWQsSUFBQSxDQUNBLElBQUFjLEdBQUEsR0FBQVYsS0FDQUosSUFBQSxDQUdBLEtBQUEsR0FBQWUsS0FBQVAsR0FFQU0sRUFBQUMsR0FBQSxrQkFBQVAsR0FBQU8sSUFDQSxrQkFBQUYsR0FBQUUsSUFBQWQsRUFBQUMsS0FBQU0sRUFBQU8sSUFDQSxTQUFBQSxFQUFBQyxHQUNBLE1BQUEsWUFDQSxHQUFBQyxHQUFBYixLQUFBUyxNQUlBVCxNQUFBUyxPQUFBQSxFQUFBRSxFQUlBLElBQUFHLEdBQUFGLEVBQUFOLE1BQUFOLEtBQUFPLFVBR0EsT0FGQVAsTUFBQVMsT0FBQUksRUFFQUMsSUFFQUgsRUFBQVAsRUFBQU8sSUFDQVAsRUFBQU8sRUFXQVYsR0FBQVMsVUFBQUEsQ0FHQSxJQUFBSyxHQUFBLEdBQUFDLFVBQ0EsbUJBQUFiLEVBQUEsVUFPQSxPQUxBRixHQUFBUyxVQUFBTyxZQUFBRixFQUdBZCxFQUFBQyxPQUFBSyxVQUFBVyxPQUVBakIsR0FJQWtCLE9BQUFDLFFBQUFuQixRQS9EQSxJQUFBb0IsV0FBQXBCLE1BQUFDLFFBQ0FvQixVQUFBLEtBQ0FDLFdBQUEsS0FDQUMsWUFBQSx3QkFFQW5CLEtBQUEsV0FRQSxHQVBB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ZnVuY3Rpb24oKXtcbiAgdmFyIGluaXRpYWxpemluZyA9IGZhbHNlLCBmblRlc3QgPSAveHl6Ly50ZXN0KGZ1bmN0aW9uKCl7eHl6O30pID8gL1xcYl9zdXBlclxcYi8gOiAvLiovO1xuXG4gIC8vIFRoZSBiYXNlIENsYXNzIGltcGxlbWVudGF0aW9uIChkb2VzIG5vdGhpbmcpXG4gIHRoaXMuQ2xhc3MgPSBmdW5jdGlvbigpe307XG5cbiAgLy8gQ3JlYXRlIGEgbmV3IENsYXNzIHRoYXQgaW5oZXJpdHMgZnJvbSB0aGlzIGNsYXNzXG4gIENsYXNzLmV4dGVuZCA9IGZ1bmN0aW9uKGNsYXNzTmFtZSwgcHJvcCkge1xuICAgIGlmKHByb3AgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHByb3AgPSBjbGFzc05hbWU7XG4gICAgICAgY2xhc3NOYW1lID0gXCJDbGFzc1wiO1xuICAgIH1cblxuICAgIHZhciBfc3VwZXIgPSB0aGlzLnByb3RvdHlwZTtcblxuICAgIC8vIEluc3RhbnRpYXRlIGEgYmFzZSBjbGFzcyAoYnV0IG9ubHkgY3JlYXRlIHRoZSBpbnN0YW5jZSxcbiAgICAvLyBkb24ndCBydW4gdGhlIGluaXQgY29uc3RydWN0b3IpXG4gICAgaW5pdGlhbGl6aW5nID0gdHJ1ZTtcbiAgICB2YXIgcHJvdG90eXBlID0gbmV3IHRoaXMoKTtcbiAgICBpbml0aWFsaXppbmcgPSBmYWxzZTtcblxuICAgIC8vIENvcHkgdGhlIHByb3BlcnRpZXMgb3ZlciBvbnRvIHRoZSBuZXcgcHJvdG90eXBlXG4gICAgZm9yICh2YXIgbmFtZSBpbiBwcm9wKSB7XG4gICAgICAvLyBDaGVjayBpZiB3ZSdyZSBvdmVyd3JpdGluZyBhbiBleGlzdGluZyBmdW5jdGlvblxuICAgICAgcHJvdG90eXBlW25hbWVdID0gdHlwZW9mIHByb3BbbmFtZV0gPT0gXCJmdW5jdGlvblwiICYmXG4gICAgICAgIHR5cGVvZiBfc3VwZXJbbmFtZV0gPT0gXCJmdW5jdGlvblwiICYmIGZuVGVzdC50ZXN0KHByb3BbbmFtZV0pID9cbiAgICAgICAgKGZ1bmN0aW9uKG5hbWUsIGZuKXtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdG1wID0gdGhpcy5fc3VwZXI7XG5cbiAgICAgICAgICAgIC8vIEFkZCBhIG5ldyAuX3N1cGVyKCkgbWV0aG9kIHRoYXQgaXMgdGhlIHNhbWUgbWV0aG9kXG4gICAgICAgICAgICAvLyBidXQgb24gdGhlIHN1cGVyLWNsYXNzXG4gICAgICAgICAgICB0aGlzLl9zdXBlciA9IF9zdXBlcltuYW1lXTtcblxuICAgICAgICAgICAgLy8gVGhlIG1ldGhvZCBvbmx5IG5lZWQgdG8gYmUgYm91bmQgdGVtcG9yYXJpbHksIHNvIHdlXG4gICAgICAgICAgICAvLyByZW1vdmUgaXQgd2hlbiB3ZSdyZSBkb25lIGV4ZWN1dGluZ1xuICAgICAgICAgICAgdmFyIHJldCA9IGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB0aGlzLl9zdXBlciA9IHRtcDtcblxuICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICB9O1xuICAgICAgICB9KShuYW1lLCBwcm9wW25hbWVdKSA6XG4gICAgICAgIHByb3BbbmFtZV07XG4gICAgfVxuXG4gICAgLy8gVGhlIGR1bW15IGNsYXNzIGNvbnN0cnVjdG9yXG4gICAgZnVuY3Rpb24gQ2xhc3MoKSB7XG4gICAgICAvLyBBbGwgY29uc3RydWN0aW9uIGlzIGFjdHVhbGx5IGRvbmUgaW4gdGhlIGluaXQgbWV0aG9kXG4gICAgICBpZiAoICFpbml0aWFsaXppbmcgJiYgdGhpcy5pbml0IClcbiAgICAgICAgdGhpcy5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxuXG4gICAgLy8gUG9wdWxhdGUgb3VyIGNvbnN0cnVjdGVkIHByb3RvdHlwZSBvYmplY3RcbiAgICBDbGFzcy5wcm90b3R5cGUgPSBwcm90b3R5cGU7XG5cbiAgICAvLyBFbmZvcmNlIHRoZSBjb25zdHJ1Y3RvciB0byBiZSB3aGF0IHdlIGV4cGVjdFxuICAgIHZhciBmdW5jID0gbmV3IEZ1bmN0aW9uKFxuICAgICAgICBcInJldHVybiBmdW5jdGlvbiBcIiArIGNsYXNzTmFtZSArIFwiKCl7IH1cIlxuICAgICkoKTtcbiAgICBDbGFzcy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBmdW5jO1xuXG4gICAgLy8gQW5kIG1ha2UgdGhpcyBjbGFzcyBleHRlbmRhYmxlXG4gICAgQ2xhc3MuZXh0ZW5kID0gYXJndW1lbnRzLmNhbGxlZTtcblxuICAgIHJldHVybiBDbGFzcztcbiAgfTtcblxuICAvL0kgb25seSBhZGRlZCB0aGlzIGxpbmVcbiAgbW9kdWxlLmV4cG9ydHMgPSBDbGFzcztcbn0pKCk7XG4iLCJcclxuLy8gdGhlIGNsYXNzLmV4dGVuZCBucG0gbW9kdWxlIG11c3QgYmUgaW5jbHVkZWQgcHJpb3IgdG8gdGhpc1xyXG4vLyBpZiB5b3UgdXNlIHRoZSBpbmNsdWRlZCBtaW5pbWl6ZWQgZmlsZSwgd2UndmUgYnVuZGxlZCB0aGF0XHJcbi8vIG1vZHVsZSB0b2dldGhlciB3aXRoIHRoaXMgb2JqZWN0IGZvciB5b3UuXHJcblxyXG52YXIgU2VhcmNoYmFyID0gQ2xhc3MuZXh0ZW5kKHtcclxuXHRzZWFyY2hiYXI6IG51bGwsXHJcblx0c2VhcmNoYWJsZTogbnVsbCxcclxuXHRoaWRkZW5DbGFzczogXCJzZWFyY2hhYmxlLXJvdy1oaWRkZW5cIixcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnNlYXJjaGJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2VhcmNoYmFyXCIpO1xyXG5cdFx0dGhpcy5zZWFyY2hhYmxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zZWFyY2hhYmxlXCIpO1xyXG5cclxuXHRcdC8vIHRvIGhhdmUgYSBzZWFyY2hiYXIsIHdlIG5lZWQgYm90aCB0aGUgc2VhcmNoYmFyIGVsZW1lbnQgYW5kXHJcblx0XHQvLyB0aGUgc2VhcmNoYWJsZSBkYXRhIHNldC4gIHdpdGhvdXQgdGhvc2UsIHdlIGNhbiBzaW1wbHkgcXVpdFxyXG5cdFx0Ly8gYmVjYXVzZSwgY2xlYXJseSwgdGhpcyBwYWdlIGRvZXNuJ3QgbmVlZCB0aGlzIGZ1bmN0aW9uYWxpdHkuXHJcblxyXG5cdFx0aWYgKCF0aGlzLnNlYXJjaGJhciB8fCAhdGhpcy5zZWFyY2hhYmxlKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBub3cgdGhhdCB3ZSBrbm93IHdlIGhhdmUgdGhvc2UsIHdlIGNhbiBwYXJzZSB0aGUgc2VhcmNoYWJsZVxyXG5cdFx0Ly8gZGF0YSBzZXQgdG8gcHJlcGFyZSBpdCBmb3IgdXNlLiAgaXQncyBwb3NzaWJsZSB0aGF0IHRoaXMgbWV0aG9kXHJcblx0XHQvLyByZXR1cm5zIGZhbHNlIHdoZW4gdGhlcmUgYXJlIG5vIHJvd3Mgd2l0aGluIHRoZSBzZXQgdG8gd29ya1xyXG5cdFx0Ly8gd2l0aC5cclxuXHJcblx0XHRpZiAoIXRoaXMucGFyc2VTZWFyY2hhYmxlKCkpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGZpbmFsbHksIG91ciBzZWFyY2hhYmxlIGRhdGEgc2V0IGlzIHJlYWR5IHRvIGdvLiAgbm93LCB3ZSBjYW5cclxuXHRcdC8vIGhvb2sgdXAgZXZlbnRzIHRvIG91ciBzZWFyY2hiYXIuXHJcblxyXG5cdFx0dmFyIGVsZW1lbnRzID0gdGhpcy5nZXRTZWFyY2hiYXJFbGVtZW50cygpO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHR0aGlzLnByb2Nlc3NTZWFyY2hiYXJFbGVtZW50KGVsZW1lbnRzW2ldKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRwYXJzZVNlYXJjaGFibGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHJvd3MgPSB0aGlzLmdldFNlYXJjaGFibGVSb3dzKCk7XHJcblxyXG5cdFx0Ly8gaWYgd2UgZG9uJ3QgaGF2ZSByb3dzLCB0aGVuIHdlIGNhbiBxdWl0LlxyXG5cclxuXHRcdGlmIChyb3dzLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gb3RoZXJ3aXNlLCBmb3IgdGhlIGNoaWxkcmVuIG9mIG91ciByb3dzIC0tIHdoaWNoIGFyZSBsaWtlbHlcclxuXHRcdC8vIHRhYmxlIGNlbGxzLCBidXQgY291bGQgYmUgc29tZXRoaW5nIGVsc2UgLS0gd2Ugd2FudCB0byBwcm9jZXNzXHJcblx0XHQvLyB0aGVtIGluZGl2aWR1YWxseSB3aXRoIHRoZSBtZXRob2QgYmVsb3cuXHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCByb3dzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdHZhciBjZWxscyA9IHJvd3NbaV0ucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLXNlYXJjaGJhci12YWx1ZV1cIik7XHJcblx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgY2VsbHMubGVuZ3RoOyArK2opIHtcclxuXHRcdFx0XHR0aGlzLnByb2Nlc3NDZWxsKGNlbGxzW2pdLCByb3dzW2ldKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH0sXHJcblxyXG5cdGdldFNlYXJjaGFibGVSb3dzOiBmdW5jdGlvbigpIHtcclxuXHJcblx0XHQvLyBmb3IgbWF4aW11bSBmbGV4aWJpbGl0eSwgd2Ugd2FudCB0byBtYWtlIHN1cmUgdGhhdCBhIGRldmVsb3BlclxyXG5cdFx0Ly8gdXNpbmcgb3VyIHNlYXJjaGJhciBjYW4gc3BlY2lmeSB3aGF0IHNob3VsZCBiZSBjb25zaWRlcmVkIGFcclxuXHRcdC8vIHNlYXJjaGFibGUgcm93LiAgYnV0LCBpZiB0aGV5IGRvbid0IGFuZCBpZiB0aGUgc2VhcmNoYWJsZSBET01cclxuXHRcdC8vIGVsZW1lbnQgaXMgYSB0YWJsZSwgdGhlbiB3ZSdsbCBqdXN0IHVzZSB0aGUgcm93cyBpbiBpdHMgdGFibGVcclxuXHRcdC8vIGJvZHkgYnkgZGVmYXVsdC5cclxuXHJcblx0XHR2YXIgcm93cyA9IHRoaXMuc2VhcmNoYWJsZS5xdWVyeVNlbGVjdG9yQWxsKFwiLnNlYXJjaGFibGUtcm93XCIpO1xyXG5cdFx0aWYgKHJvd3MubGVuZ3RoID09PSAwICYmIHRoaXMuc2VhcmNoYWJsZS50YWdOYW1lID09PSBcIlRBQkxFXCIpIHtcclxuXHRcdFx0cm93cyA9IHRoaXMuc2VhcmNoYWJsZS5xdWVyeVNlbGVjdG9yQWxsKFwidGJvZHkgdHJcIik7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHJvd3M7XHJcblx0fSxcclxuXHJcblx0cHJvY2Vzc0NlbGw6IGZ1bmN0aW9uKGNlbGwsIHJvdykge1xyXG5cclxuXHRcdC8vIHRvIHByb2Nlc3MgYSBjZWxsLCB3ZSB3YW50IHRvIGFkZCBIVE1MNSBkYXRhIGF0dHJpYnV0ZXMgdGhhdFxyXG5cdFx0Ly8gY29ycmVzcG9uZCB0byBpbmZvcm1hdGlvbiBleHRyYWN0ZWQgZnJvbSB0aGUgY2VsbCBpdHNlbGYgdG9cclxuXHRcdC8vIHRoZSBzcGVjaWZpZWQgcm93LiAgdGhpcyBpcyBiZWNhdXNlIG91ciBzZWFyY2ggbWV0aG9kIGxvb2tzXHJcblx0XHQvLyBhdCB0aGUgcm93cyB3aGVuIG1hdGNoaW5nIGVudHJpZXMgYWdhaW5zdCBkYXRhLlxyXG5cclxuXHRcdHZhciBhdHRyID0gXCJkYXRhLVwiICsgY2VsbC5nZXRBdHRyaWJ1dGUoXCJoZWFkZXJzXCIpO1xyXG5cdFx0dmFyIHZhbHVlID0gY2VsbC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXNlYXJjaGJhci12YWx1ZVwiKTtcclxuXHRcdHJvdy5zZXRBdHRyaWJ1dGUoYXR0ciwgdmFsdWUpO1xyXG5cclxuXHRcdGlmIChjZWxsLmdldEF0dHJpYnV0ZShcImRhdGEtc2VhcmNoYmFyLXZhbHVlLWxpc3RcIikgPT09IFwiMVwiKSB7XHJcblx0XHRcdHJvdy5zZXRBdHRyaWJ1dGUoYXR0ciArIFwiLWxpc3RcIiwgMSk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Z2V0U2VhcmNoYmFyRWxlbWVudHM6IGZ1bmN0aW9uKCkge1xyXG5cclxuXHRcdC8vIG91ciBzZWFyY2hiYXIgdXNlcyB0aGVzZSBIVE1MIGVsZW1lbnRzIGF0IHRoZSBtb21lbnQuICBpZiB3ZVxyXG5cdFx0Ly8gYWQgbW9yZSwgd2UnbGwgbmVlZCB0byB1cGRhdGUgdGhpcyBsaXN0LlxyXG5cclxuXHRcdHJldHVybiB0aGlzLnNlYXJjaGJhci5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXQsIHNlbGVjdCwgYnV0dG9uXCIpO1xyXG5cdH0sXHJcblxyXG5cdHByb2Nlc3NTZWFyY2hiYXJFbGVtZW50OiBmdW5jdGlvbihlbGVtZW50KSB7XHJcblx0XHR2YXIgZXZlbnQgPSBcIlwiLCB3YWl0ID0gMDtcclxuXHJcblx0XHQvLyB0aGUgZXZlbnQgd2Ugd2FudCB0byB1c2UgaXMgYmFzZWQgb24gdGhlIHR5cGUgb2YgZWxlbWVudCB0aGF0XHJcblx0XHQvLyB3ZSdyZSB3b3JraW5nIHdpdGguICBtb3N0IG9mIG91ciBldmVudHMgZG9uJ3QgbmVlZCB0byBiZVxyXG5cdFx0Ly8gZGVib3VuY2VkLCBidXQgaWYgd2UgcnVuIGludG8gb25lIHRoYXQgZG9lcywgd2UgY2FuIHNldCBvdXJcclxuXHRcdC8vIHdhaXQgdmFyaWFibGUgdG8gc29tZXRoaW5nIG90aGVyIHRoYW4gemVyby5cclxuXHJcblx0XHRzd2l0Y2ggKGVsZW1lbnQudHlwZSkge1xyXG5cdFx0XHRjYXNlIFwidGV4dFwiOlxyXG5cdFx0XHRcdGV2ZW50ID0gXCJrZXl1cFwiO1xyXG5cdFx0XHRcdHdhaXQgPSAxNTA7XHJcblx0XHRcdFx0YnJlYWs7XHJcblxyXG5cdFx0XHRjYXNlIFwic2VsZWN0LW9uZVwiOlxyXG5cdFx0XHRcdGV2ZW50ID0gXCJjaGFuZ2VcIjtcclxuXHRcdFx0XHRicmVhaztcclxuXHJcblx0XHRcdGNhc2UgXCJjaGVja2JveFwiOlxyXG5cdFx0XHRcdGV2ZW50ID0gXCJjbGlja1wiO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdFx0Y2FzZSBcInJlc2V0XCI6XHJcblx0XHRcdFx0ZXZlbnQgPSBcImNsaWNrXCI7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKGV2ZW50Lmxlbmd0aCA+IDApIHtcclxuXHJcblx0XHRcdC8vIGlmIHdlIGlkZW50aWZpZWQgYW4gZXZlbnQgdG8gbGlzdGVuIGZvciwgd2UnbGwgbm93IGlkZW50aWZ5XHJcblx0XHRcdC8vIHdoaWNoIGZ1bmN0aW9uIHRvIGNhbGwuICBpZiB3ZSdyZSBub3QgbWVzc2luZyB3aXRoIHRoZSByZXNldFxyXG5cdFx0XHQvLyBlbGVtZW50LCB3ZSBzZWFyY2g7IG90aGVyd2lzZSB3ZSByZXNldC5cclxuXHJcblx0XHRcdHZhciBmdW5jID0gZWxlbWVudC50eXBlICE9PSBcInJlc2V0XCJcclxuXHRcdFx0XHQ/IHRoaXMuZGVib3VuY2UodGhpcy5zZWFyY2gsIHdhaXQpLmJpbmQodGhpcylcclxuXHRcdFx0XHQ6IHRoaXMucmVzZXQuYmluZCh0aGlzKTtcclxuXHJcblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgZnVuYyk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0c2VhcmNoOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBiZWZvcmVTZWFyY2ggPSBuZXcgRXZlbnQoXCJzZWFyY2hiYXI6YmVmb3JlU2VhcmNoXCIpO1xyXG5cdFx0dmFyIGNhbmNlbGxlZCA9ICF0aGlzLnNlYXJjaGJhci5kaXNwYXRjaEV2ZW50KGJlZm9yZVNlYXJjaCk7XHJcblx0XHRpZiAoY2FuY2VsbGVkKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBhc3N1bWluZyBzb21ldGhpbmcgZWxzZSBkaWRuJ3QgY2FuY2VsIG91ciBzZWFyY2gsIHRoZSBmaXJzdFxyXG5cdFx0Ly8gdGhpbmcgd2UgZG8gaXMgcmVzZXQgb3VyIHRhYmxlLiAgdGhhdCB3YXksIHdlIGtub3cgdGhhdCB3ZVxyXG5cdFx0Ly8gc3RhcnQgd2l0aCB0aGUgZW50aXJlIHRoaW5nIHZpc2libGUgYW5kIHdlJ2xsIGZpbmQgdGhlIG9uZXNcclxuXHRcdC8vIHRoYXQgbmVlZCB0byBiZSBoaWRkZW4gYmVsb3cuXHJcblxyXG5cdFx0dGhpcy5yZXNldFNlYXJjaGFibGUoKTtcclxuXHRcdHZhciByb3dzID0gdGhpcy5nZXRTZWFyY2hhYmxlUm93cygpO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCByb3dzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdHZhciByb3cgPSByb3dzW2ldLCBzaG93ID0gdHJ1ZTtcclxuXHJcblx0XHRcdC8vIGZvciBlYWNoIHJvdywgd2UgbmVlZCB0byBjb21wYXJlIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGVcclxuXHRcdFx0Ly8gSFRNTDUgZGF0YSBhdHRyaWJ1dGVzIGFkZGVkIGJ5IHRoZSBwYXJzZVNlYXJjaGFibGUoKSBtZXRob2RcclxuXHRcdFx0Ly8gYWJvdmUgYWdhaW5zdCB0aGUgdmFsdWVzIGluIG91ciBzZWFyY2hiYXIgZWxlbWVudHMuXHJcblxyXG5cdFx0XHR2YXIgZWxlbWVudHMgPSB0aGlzLmdldFNlYXJjaGJhckVsZW1lbnRzKCk7XHJcblx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgZWxlbWVudHMubGVuZ3RoOyBqKyspIHtcclxuXHRcdFx0XHRpZiAoIXNob3cpIHtcclxuXHJcblx0XHRcdFx0XHQvLyB3ZSB1c2UgQU5EIGxvZ2ljIGhlcmUuICB0aGUgZmlyc3QgdGhpbmcgdGhhdCB3b3VsZFxyXG5cdFx0XHRcdFx0Ly8gaGlkZSBvdXIgcm93IG1lYW5zIHRoZSByb3cgaXMgaGlkZGVuIGFuZCB3ZSBjYW5cclxuXHRcdFx0XHRcdC8vIHNraXAgYWxsIG90aGVyIGNyaXRlcmlvbi5cclxuXHJcblx0XHRcdFx0XHRjb250aW51ZTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHZhciBlbGVtZW50ID0gZWxlbWVudHNbal07XHJcblx0XHRcdFx0dmFyIHZhbHVlID0gdGhpcy5nZXRWYWx1ZShlbGVtZW50KTtcclxuXHRcdFx0XHR2YXIgYXR0ciA9IHRoaXMuZ2V0QXR0cihlbGVtZW50KTtcclxuXHJcblx0XHRcdFx0Ly8gaWYgd2UgZG9uJ3QgaGF2ZSBhbiBhdHRyaWJ1dGUgb3IgdmFsdWUgb3IgaWYgdGhlIHZhbHVlXHJcblx0XHRcdFx0Ly8gd2UgZG8gaGF2ZSBpbmRpY2F0ZXMgdGhhdCB3ZSBzaG91bGQgYmUgc2hvd2luZyBhbGwgb2ZcclxuXHRcdFx0XHQvLyBvdXIgcm93cywgd2UgY2FuIHNpbXBseSBtb3ZlIG9uOyB0aGlzIGNyaXRlcmlhIGlzLFxyXG5cdFx0XHRcdC8vIGVmZmVjdGl2ZWx5LCBhbHdheXMgbWV0LlxyXG5cclxuXHRcdFx0XHRpZiAoIWF0dHIgfHwgIXZhbHVlIHx8IHZhbHVlID09PSBcImFsbFwiKSB7XHJcblx0XHRcdFx0XHRjb250aW51ZTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHZhciBjcml0ZXJpb24gPSBlbGVtZW50LnR5cGUgIT09IFwidGV4dFwiXHJcblx0XHRcdFx0XHQ/IHRoaXMubm9uVGV4dFNlYXJjaChyb3csIGF0dHIsIHZhbHVlKVxyXG5cdFx0XHRcdFx0OiB0aGlzLnRleHRTZWFyY2gocm93LCBhdHRyLCB2YWx1ZSk7XHJcblxyXG5cdFx0XHRcdHNob3cgPSBzaG93ICYmIGNyaXRlcmlvbjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKCFzaG93KSB7XHJcblxyXG5cdFx0XHRcdC8vIGZpbmFsbHksIGlmIHRoaXMgcm93IHNob3VsZCBub3QgYmUgc2hvd24sIHRoZW4gd2UgYWRkXHJcblx0XHRcdFx0Ly8gdGhlIGhpZGRlbiBjbGFzcyB0byBpdC5cclxuXHJcblx0XHRcdFx0cm93LmNsYXNzTGlzdC5hZGQodGhpcy5oaWRkZW5DbGFzcyk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLnNlYXJjaGJhci5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChcInNlYXJjaGJhcjphZnRlclNlYXJjaFwiKSk7XHJcblx0fSxcclxuXHJcblx0Z2V0VmFsdWU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcclxuXHJcblx0XHQvLyB0ZXh0LCBzZWxlY3RzLCBhbmQgY2hlY2tib3hlcyBhbGwgd29yayBkaWZmZXJlbnRseSB3aXRoXHJcblx0XHQvLyByZXNwZWN0IHRvIHdoYXQgd2UgY29uc2lkZXIgb3VyIFwidmFsdWVcIiBmb3Igc2VhcmNoaW5nXHJcblx0XHQvLyBwdXJwb3Nlcy4gIHRoaXMgc3dpdGNoIHN0YXRlbWVudCBtaXhlcyB0aGluZ3MgdXAgYW5kXHJcblx0XHQvLyBncmFicyBvbmx5IHdoYXQgd2UgbmVlZCBkdXJpbmcgb3VyIHNlYXJjaCBhYm92ZSB0byBtYWtlXHJcblx0XHQvLyB0aGluZ3MgaGFwcGVuLlxyXG5cclxuXHRcdHN3aXRjaCAoZWxlbWVudC50eXBlKSB7XHJcblx0XHRcdGNhc2UgXCJ0ZXh0XCI6XHJcblx0XHRcdFx0cmV0dXJuIGVsZW1lbnQudmFsdWU7XHJcblxyXG5cdFx0XHRjYXNlIFwic2VsZWN0LW9uZVwiOlxyXG5cdFx0XHRcdHJldHVybiBlbGVtZW50Lm9wdGlvbnNbZWxlbWVudC5zZWxlY3RlZEluZGV4XS52YWx1ZTtcclxuXHJcblx0XHRcdGNhc2UgXCJjaGVja2JveFwiOlxyXG5cdFx0XHRcdHJldHVybiBlbGVtZW50LmNoZWNrZWQ7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIFwiXCI7XHJcblx0fSxcclxuXHJcblx0Z2V0QXR0cjogZnVuY3Rpb24oZWxlbWVudCkge1xyXG5cclxuXHRcdC8vIHRoZSBIVE1MNSBkYXRhIGVsZW1lbnRzIHRoYXQgcGFyc2VTZWFyY2hhYmxlKCkgY3JlYXRlc1xyXG5cdFx0Ly8gYXJlIGRhdGEtW2lkXSB3aGVyZSB0aGUgaWQgaXMgdGhlIHZhbHVlIG9mIG91ciBlbGVtZW50J3NcclxuXHRcdC8vIElEIGF0dHJpYnV0ZS5cclxuXHJcblx0XHR2YXIgaWQgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShcImlkXCIpO1xyXG5cclxuXHRcdGlmIChpZCkge1xyXG5cclxuXHRcdFx0Ly8gaWYgd2UgaGF2ZSBhbiBJRCwgdGhlbiB3ZSBuZWVkIHRvIHJlbW92ZSBldmVyeXRoaW5nXHJcblx0XHRcdC8vIGFmdGVyIHRoZSB1bmRlcnNjb3JlLCBpbmNsdWRpbmcgdGhlIHVuZGVyc2NvcmUuICB3ZVxyXG5cdFx0XHQvLyBleHBlY3Qgb3VyIElEcyBmb3Igc2VhcmNoaW5nIGVsZW1lbnRzIHRvIGJlIGluIHRoZVxyXG5cdFx0XHQvLyBmb3JtIG9mIFtpZF1fW3R5cGVdLCBzbyB0aGlzIHNpbXBseSBsZWF2ZXMgdXMgd2l0aFxyXG5cdFx0XHQvLyB0aGUgaWQuXHJcblxyXG5cdFx0XHRpZCA9IGlkLnJlcGxhY2UoL18uKi8sIFwiXCIpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0cmV0dXJuIFwiXCI7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gc3RpbGwgaGVyZT8gIHRoZW4gd2UgY2FuIGNvbnN0cnVjdCB0aGUgb3VyIGRhdGFcclxuXHRcdC8vIGF0dHJpYnV0ZSB1c2luZyB0aGUgSUQgd2UncmUgbGVmdCB3aXRoLlxyXG5cclxuXHRcdHJldHVybiBcImRhdGEtXCIgKyBpZDtcclxuXHR9LFxyXG5cclxuXHRub25UZXh0U2VhcmNoOiBmdW5jdGlvbihyb3csIGF0dHIsIHZhbHVlKSB7XHJcblxyXG5cdFx0Ly8gaWYgb3VyIHJvdyBoYXMgYSBsaXN0IGZsYWcgZm9yIHRoaXMgYXR0cmlidXRlLCB0aGVuIHdlXHJcblx0XHQvLyB3YW50IHRvIHNlZSBpZiBvdXIgYXR0cmlidXRlIGNvbnRhaW5zIHRoZSB2YWx1ZS4gIG90aGVyd2lzZSxcclxuXHRcdC8vIHdlIGNoZWNrIHRvIHNlZSB0aGUgYXR0cmlidXRlIG1hdGNoZXMgaXQuICB3aXRoIHJlc3BlY3QgdG9cclxuXHRcdC8vIHRoZSBtYXRjaGVzKCkgY2FsbCBoZXJlLCBpZiB3ZSBhc3N1bWUgb3VyIHZhbHVlIGlzIDEsIHRoZW5cclxuXHRcdC8vIHdlIHNlYXJjaCBmb3IgXzFfLiAgdGhpcyBpcyB0byBhdm9pZCBpbnZhbGlkIHNlbGVjdG9yIGVycm9yc1xyXG5cdFx0Ly8gd2l0aGluIHRoZSBqYXZhc2NyaXB0LiAgZnVydGhlciwgaXQgaGVscHMgZGlzdGluZ3Vpc2ggYmV0d2VlblxyXG5cdFx0Ly8gXzFfIGFuZCBfMTFfIG9yIF93b25fIGFuZCBfd29uZGVyXywgZm9yIGV4YW1wbGUuXHJcblxyXG5cdFx0cmV0dXJuIHJvdy5oYXNBdHRyaWJ1dGUoYXR0ciArIFwiLWxpc3RcIilcclxuXHRcdFx0PyByb3cubWF0Y2hlcyhcIltcIiArIGF0dHIgKyBcIio9X1wiICsgdmFsdWUgKyBcIl9dXCIpXHJcblx0XHRcdDogcm93LmdldEF0dHJpYnV0ZShhdHRyKSA9PT0gdmFsdWU7XHJcblx0fSxcclxuXHJcblx0dGV4dFNlYXJjaDogZnVuY3Rpb24ocm93LCBhdHRyLCB2YWx1ZSkge1xyXG5cclxuXHRcdC8vIGZvciB0ZXh0IHNlYXJjaGVzLCB3ZSBjb25zdHJ1Y3QgYSByZWdleCBmcm9tIHRoZSB2YWx1ZSBvZlxyXG5cdFx0Ly8gb3VyIHNlYXJjaCBmaWVsZCBhbmQgc2VlIGlmIHRoaXMgcm93IG1hdGNoZXMgaXQuICB3ZSBwdXRcclxuXHRcdC8vIHRoaXMgYWxsIGluc2lkZSBhIHRyeS9jYXRjaCBibG9jayBiZWNhdXNlIGl0J3MgcG9zc2libGUgdG9cclxuXHRcdC8vIGNyZWF0ZSBhIHZhbHVlIHRoYXQgY2FuJ3QgYmUgYSByZWdleCwgYW5kIHRoZW4gYW4gZXhjZXB0aW9uXHJcblx0XHQvLyBpcyB0aHJvd24uXHJcblxyXG5cdFx0dHJ5IHtcclxuXHRcdFx0dmFyIHBhdHRlcm4gPSBuZXcgUmVnRXhwKHZhbHVlLCBcImlcIik7XHJcblx0XHRcdHJldHVybiByb3cuZ2V0QXR0cmlidXRlKGF0dHIpLm1hdGNoKHBhdHRlcm4pO1xyXG5cdFx0fSBjYXRjaCAoZSkge1xyXG5cclxuXHRcdFx0Ly8gaWYgd2UgY291bGRuJ3QgZXZlbiBtYWtlIG91ciBwYXR0ZXJuLCB0aGVuIHdlJ2xsIGFzc3VtZVxyXG5cdFx0XHQvLyB0aGF0IHdoYXRldmVyIHdlIGhhdmUgY291bGQgbm90IGJlIG1hdGNoZWQgYW5kIHJldHVyblxyXG5cdFx0XHQvLyBmYWxzZS5cclxuXHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRyZXNldDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgYmVmb3JlUmVzZXQgPSBuZXcgRXZlbnQoXCJzZWFyY2hiYXI6cmVzZXRcIik7XHJcblx0XHR2YXIgY2FuY2VsbGVkID0gIXRoaXMuc2VhcmNoYmFyLmRpc3BhdGNoRXZlbnQoYmVmb3JlUmVzZXQpO1xyXG5cclxuXHRcdGlmICghY2FuY2VsbGVkKSB7XHJcblxyXG5cdFx0XHQvLyBpZiBubyBvbmUgY2FuY2VsbGVkIG91ciByZXNldCwgdGhlbiB3ZSBqdXN0IHJlc2V0IHRoZVxyXG5cdFx0XHQvLyBzZWFyY2hiYXIgZm9ybSBhbmQgb3VyIHNlYXJjaGFibGUgZGF0YSBzZXQuXHJcblxyXG5cdFx0XHR0aGlzLnNlYXJjaGJhci5yZXNldCgpO1xyXG5cdFx0XHR0aGlzLnJlc2V0U2VhcmNoYWJsZSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9LFxyXG5cclxuXHRyZXNldFNlYXJjaGFibGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHJvd3MgPSB0aGlzLmdldFNlYXJjaGFibGVSb3dzKCk7XHJcblxyXG5cdFx0Ly8gcmVzZXR0aW5nIG91ciBkYXRhIHNldCBpcyBzaW1wbGU6ICB3ZSBqdXN0IHJlbW92ZSB0aGUgaGlkZGVuXHJcblx0XHQvLyBjbGFzcyBmcm9tIGFsbCByb3dzLlxyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcm93cy5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRyb3dzW2ldLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5oaWRkZW5DbGFzcyk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0ZGVib3VuY2U6IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkge1xyXG5cdFx0aWYgKHdhaXQgPT09IDApIHtcclxuXHRcdFx0cmV0dXJuIGZ1bmM7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gc291cmNlOiBodHRwczovL2Rhdmlkd2Fsc2gubmFtZS9qYXZhc2NyaXB0LWRlYm91bmNlLWZ1bmN0aW9uXHJcblxyXG5cdFx0dmFyIHRpbWVvdXQ7XHJcblx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7XHJcblx0XHRcdHZhciBjb250ZXh0ID0gdGhpcywgYXJncyA9IGFyZ3VtZW50cztcclxuXHRcdFx0dmFyIGxhdGVyID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0dGltZW91dCA9IG51bGw7XHJcblx0XHRcdFx0aWYgKCFpbW1lZGlhdGUpIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XHJcblx0XHRcdH07XHJcblx0XHRcdHZhciBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0O1xyXG5cdFx0XHRjbGVhclRpbWVvdXQodGltZW91dCk7XHJcblx0XHRcdHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTtcclxuXHRcdFx0aWYgKGNhbGxOb3cpIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XHJcblx0XHR9O1xyXG5cdH1cclxufSk7XHJcbiJdfQ==
